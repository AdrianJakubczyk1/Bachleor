<!DOCTYPE html>
<html data-bs-theme="dark" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="'Lessons for ' + ${schoolClass.name}">Lessons</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/darkMode.css}" />
    <style>
        .lesson-card { margin-bottom: 15px; }
    </style>
</head>
<body class="d-flex flex-column min-vh-100 bg-dark text-light">
<!-- Navbar Fragment -->
<div th:replace="~{common :: navbar(loggedIn=${loggedIn}, isAdmin=${isAdmin}, title=${title})}"></div>

<main class="container my-5 flex-grow-1">
    <h2 th:text="'Lessons for ' + ${schoolClass.name}">Lessons</h2>

    <table class="table table-striped table-dark border-secondary align-middle">
        <thead>
        <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="lesson : ${lessons}">
            <td th:text="${lesson.title}">Title</td>
            <td th:text="${lesson.description}">Description</td>
            <td>
                <!-- Always link to lesson detail -->
                <a th:href="@{'/lessons/' + ${lesson.id}}" class="btn btn-outline-light btn-sm mt-1">View Lesson</a>

                <!-- If a task exists for this lesson -->
                <div th:if="${lessonTaskMapping[lesson.id] != null}">
                    <!-- Show 'Send Solution' only if not yet submitted -->
                    <a th:if="${submittedTaskIds == null or !submittedTaskIds.contains(lessonTaskMapping[lesson.id])}"
                       th:href="@{/classes/{classId}/lessons/{lessonId}/tasks/{taskId}/sendSolution/new(
                 classId=${schoolClass.id},
                 lessonId=${lesson.id},
                 taskId=${lessonTaskMapping[lesson.id]})}"
                       class="btn btn-warning btn-sm mt-1">
                        Send Solution
                    </a>

                    <!-- Otherwise show confirmation -->
                    <span th:if="${submittedTaskIds != null and submittedTaskIds.contains(lessonTaskMapping[lesson.id])}"
                          class="badge text-bg-success ms-2 mt-1">Solution sent</span>
                </div>

                <!-- No task for this lesson -->
                <span th:if="${lessonTaskMapping[lesson.id] == null}" class="text-danger ms-2">Task not available</span>
            </td>
        </tr>
        </tbody>
    </table>

    <a th:href="@{/classes}" class="btn btn-outline-light">Back to Classes</a>
</main>
<!-- Footer Fragment -->
<div th:replace="~{common :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>